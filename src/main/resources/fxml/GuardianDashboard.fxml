<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" 
           fx:controller="com.example.viewfx.GuardianDashboardController"
           styleClass="dashboard-container">
    
    <!-- Top Header -->
    <top>
        <HBox styleClass="header" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets top="15" right="30" bottom="15" left="30"/>
            </padding>
            
            <Label text="ðŸ›¡ï¸ Guardian Dashboard" styleClass="header-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="notificationBadge" styleClass="notification-badge" visible="false"/>
            <Label fx:id="userLabel" text="Welcome, Guardian" style="-fx-font-size: 16px; -fx-text-fill: #2c3e50;"/>
            <Button text="Logout" onAction="#handleLogout" styleClass="danger-button"/>
        </HBox>
    </top>
    
    <!-- Center Content -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE">
            
            <!-- Patients Overview Tab -->
            <Tab text="ðŸ‘¥ My Patients">
                <VBox spacing="20">
                    <padding>
                        <Insets top="25" right="25" bottom="25" left="25"/>
                    </padding>
                    
                    <!-- Link Patient Section -->
                    <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
                        <Label text="Link New Patient:"/>
                        <TextField fx:id="linkPatientField" promptText="Enter patient username" prefWidth="250"/>
                        <Button text="ðŸ”— Link Patient" onAction="#handleLinkPatient" styleClass="success-button"/>
                    </HBox>
                    
                    <!-- Linked Patients Table -->
                    <VBox styleClass="card" VBox.vgrow="ALWAYS">
                        <Label text="ðŸ‘¥ Linked Patients" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                        <TableView fx:id="patientsTable" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets top="10"/>
                            </padding>
                            <columns>
                                <TableColumn fx:id="patientIdColumn" text="ID" prefWidth="50"/>
                                <TableColumn fx:id="patientNameColumn" text="Patient Name" prefWidth="200"/>
                                <TableColumn fx:id="patientUsernameColumn" text="Username" prefWidth="150"/>
                                <TableColumn fx:id="linkedSinceColumn" text="Linked Since" prefWidth="150"/>
                                <TableColumn fx:id="adherenceColumn" text="Adherence %" prefWidth="120"/>
                                <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>
            
            <!-- Patient Details Tab -->
            <Tab text="Patient History">
                <VBox spacing="20">
                    <padding>
                        <Insets top="25" right="25" bottom="25" left="25"/>
                    </padding>
                    
                    <!-- Patient Selection -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label text="Select Patient:"/>
                        <ComboBox fx:id="patientComboBox" promptText="Choose a patient" prefWidth="250"/>
                        <Button text="View History" onAction="#loadPatientHistory" styleClass="secondary-button"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="Date Range:"/>
                        <DatePicker fx:id="histStartDate" promptText="Start"/>
                        <Label text="to"/>
                        <DatePicker fx:id="histEndDate" promptText="End"/>
                        <Button text="ðŸ” Filter" onAction="#filterPatientHistory" styleClass="secondary-button"/>
                    </HBox>
                    
                    <!-- Patient Profile Card -->
                    <VBox fx:id="patientProfileCard" styleClass="card" spacing="15" visible="false" managed="false">
                        <Label text="Patient Profile" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                        <GridPane hgap="20" vgap="12">
                            <columnConstraints>
                                <ColumnConstraints minWidth="120" halignment="RIGHT"/>
                                <ColumnConstraints minWidth="250"/>
                                <ColumnConstraints minWidth="120" halignment="RIGHT"/>
                                <ColumnConstraints minWidth="250"/>
                            </columnConstraints>
                            
                            <Label text="Full Name:" style="-fx-font-weight: bold; -fx-text-fill: #7f8c8d;" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <Label fx:id="profileFullNameLabel" text="-" style="-fx-text-fill: #2c3e50;" GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            
                            <Label text="Username:" style="-fx-font-weight: bold; -fx-text-fill: #7f8c8d;" GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                            <Label fx:id="profileUsernameLabel" text="-" style="-fx-text-fill: #2c3e50;" GridPane.columnIndex="3" GridPane.rowIndex="0"/>
                            
                            <Label text="Email:" style="-fx-font-weight: bold; -fx-text-fill: #7f8c8d;" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <Label fx:id="profileEmailLabel" text="-" style="-fx-text-fill: #2c3e50;" GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                            
                            <Label text="Role:" style="-fx-font-weight: bold; -fx-text-fill: #7f8c8d;" GridPane.columnIndex="2" GridPane.rowIndex="1"/>
                            <Label fx:id="profileRoleLabel" text="Patient" style="-fx-text-fill: #3498db;" GridPane.columnIndex="3" GridPane.rowIndex="1"/>
                            
                            <Label text="Account Created:" style="-fx-font-weight: bold; -fx-text-fill: #7f8c8d;" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                            <Label fx:id="profileCreatedLabel" text="-" style="-fx-text-fill: #2c3e50;" GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                            
                            <Label text="Status:" style="-fx-font-weight: bold; -fx-text-fill: #7f8c8d;" GridPane.columnIndex="2" GridPane.rowIndex="2"/>
                            <Label fx:id="profileStatusLabel" text="Active" style="-fx-text-fill: #2ecc71; -fx-font-weight: bold;" GridPane.columnIndex="3" GridPane.rowIndex="2"/>
                        </GridPane>
                    </VBox>
                    
                    <!-- Statistics Cards -->
                    <HBox spacing="20" alignment="CENTER">
                        <VBox styleClass="stats-card" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS">
                            <Label fx:id="totalDosesLabel" text="0" styleClass="stats-value" style="-fx-text-fill: #3498db;"/>
                            <Label text="Total Doses" styleClass="stats-label"/>
                        </VBox>
                        
                        <VBox styleClass="stats-card" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS">
                            <Label fx:id="takenDosesLabel" text="0" styleClass="stats-value" style="-fx-text-fill: #2ecc71;"/>
                            <Label text="Taken" styleClass="stats-label"/>
                        </VBox>
                        
                        <VBox styleClass="stats-card" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS">
                            <Label fx:id="missedDosesLabel" text="0" styleClass="stats-value" style="-fx-text-fill: #e74c3c;"/>
                            <Label text="Missed" styleClass="stats-label"/>
                        </VBox>
                        
                        <VBox styleClass="stats-card" alignment="CENTER" spacing="10" HBox.hgrow="ALWAYS">
                            <Label fx:id="adherencePercentLabel" text="0%" styleClass="stats-value" style="-fx-text-fill: #9b59b6;"/>
                            <Label text="Adherence" styleClass="stats-label"/>
                        </VBox>
                    </HBox>
                    
                    <!-- History Table -->
                    <VBox styleClass="card" VBox.vgrow="ALWAYS">
                        <Label text="Dose History" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                        <TableView fx:id="patientHistoryTable" VBox.vgrow="ALWAYS">
                            <padding>
                                <Insets top="10"/>
                            </padding>
                            <columns>
                                <TableColumn fx:id="histDateColumn" text="Date" prefWidth="120"/>
                                <TableColumn fx:id="histTimeColumn" text="Time" prefWidth="100"/>
                                <TableColumn fx:id="histMedicineColumn" text="Medicine" prefWidth="200"/>
                                <TableColumn fx:id="histStatusColumn" text="Status" prefWidth="120"/>
                                <TableColumn fx:id="histNotesColumn" text="Notes" prefWidth="300"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>
            
            <!-- Notifications Tab -->
            <Tab text="Notifications">
                <VBox spacing="20">
                    <padding>
                        <Insets top="25" right="25" bottom="25" left="25"/>
                    </padding>
                    
                    <!-- Notification Actions -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label fx:id="unreadCountLabel" text="0 unread notifications" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="âœ“ Mark All Read" onAction="#markAllRead" styleClass="secondary-button"/>
                        <Button text="ðŸ”„ Refresh" onAction="#refreshNotifications" styleClass="secondary-button"/>
                    </HBox>
                    
                    <!-- Notifications List -->
                    <ListView fx:id="notificationsList" VBox.vgrow="ALWAYS" styleClass="list-view"/>
                </VBox>
            </Tab>
            
        </TabPane>
    </center>
    
</BorderPane>
